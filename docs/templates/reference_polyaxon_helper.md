Polyaxon helper is a lightweight python library to report metrics and communicate information with Polyaxon.


## Install

You can install the helper directly if you want to provide a prepared docker image by running.

```bash
$ pip install -U polyaxon-helper
```

for python3

```bash
$ pip3 install -U polyaxon-helper
```

## Install in polyaxonfile

If you want to delegate the installation to polyaxon during the build process,
add a new step to the `run` section in your polyaxonfile:

```yaml
...
build:
  image: ...
  build_steps:
    - ...
    - pip install -U polyaxon-helper
    - ...

run:
  cmd: ...
```


## Getting env variables defined by Polyaxon

Polyaxon defines some variables related to your experiment in environment variables, namely:

 * `POLYAXON_CLUSTER` : defines the cluster definition, e.g.
    ```json
    {
        "master": ["plxjob-master0-8eefb7a1146f476ca66e3bee9b88c1de:2000"],
        "worker": ["plxjob-worker1-8eefb7a1146f476ca66e3bee9b88c1de:2000",
                   "plxjob-worker2-8eefb7a1146f476ca66e3bee9b88c1de:2000"],
        "ps": ["plxjob-master0-8eefb7a1146f476ca66e3bee9b88c1de:2000"],
    }
    ```
 * `POLYAXON_DECLARATIONS` : defines all the declarations of you polyaxonfile as well as the values from hyperparameters search.
 * `POLYAXON_EXPERIMENT_INFO` : defines information about experiment, group, project.
 * `POLYAXON_TASK_INFO` : defines information about the current job/task.
 * `POLYAXON_OUTPUTS_PATH`: defines the outputs path you should use to export your model, tensorboard metrics, ...
 * `POLYAXON_LOG_LEVEL`: The log level if defined in the polyaxonfile.

Of course you can get these values on your own, e.g. in python:

```python
import os

os.getenv('POLYAXON_CLUSTER', None)
```

however we recommend using our helper library, so that your code and models will be backward compatible to future changes of the platform.

```python
from polyaxon_helper import (
    get_cluster_def,
    get_declarations,
    get_experiment_info,
    get_task_info,
    get_tf_config,
    get_outputs_path,
    get_data_path,
    get_log_level
)

cluster_def = get_cluster_def()
declarations = get_declarations()
experiment_info = get_experiment_info()
task_info = get_task_info()
outputs_path = get_outputs_path()
data_path = get_data_path()
tf_config = get_tf_config()
log_level = get_log_level()
```


 * `get_cluster_def`: Returns cluster definition created by polyaxon.
    ```json
    {
        "master": ["plxjob-master0-8eefb7a1146f476ca66e3bee9b88c1de:2000"],
        "worker": ["plxjob-worker1-8eefb7a1146f476ca66e3bee9b88c1de:2000",
                   "plxjob-worker2-8eefb7a1146f476ca66e3bee9b88c1de:2000"],
        "ps": ["plxjob-master0-8eefb7a1146f476ca66e3bee9b88c1de:2000"],
    }
    ```
 * `get_declarations`: Returns all the experiment declarations based on both,

    * declarations section
    * matrix section

 * `get_experiment_info`: Returns information about the experiment.

    * project_name
    * experiment_group_name
    * experiment_name
    * project_uuid
    * experiment_group_uuid
    * experiment_uuid

 * `get_task_info`: Returns the task info: `{"type": str, "index": int}`.

 * `outputs_path`: The ouputs path generated by polyaxon based on the hierarchy of the experiment.

        `user/project/group/experiment/files`

 * `data_outputs`: The data path generated by polyaxon based on the hierarchy of the projet:

        `user/project/`

 * `get_tf_config`: Returns the TF_CONFIG defining the cluster and the current task.
   if `envvar` is not null, it will set and env variable with `envvar`.

 * `get_log_level`: If set on the polyaxonfile it will return the log level.



## Reporting metrics to Polyaxon

In order to report metrics for an experiment, just add these lines in you program.

```python
from polyaxon_helper import send_metrics

send_metrics(accuracy=0.9, precision=0.95)
```
